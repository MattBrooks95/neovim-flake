diff --git a/makefile b/makefile
index 41a2928..7e79738 100644
--- a/makefile
+++ b/makefile
@@ -26,28 +26,28 @@ CWARNS = -Wall -Wextra -pedantic \
 
 
 CFLAGS = $(CWARNS) $(COPT) -std=c99 -I$(LUADIR) -fPIC
-CC = gcc
+CC = clang
 
 FILES = lpvm.o lpcap.o lptree.o lpcode.o lpprint.o lpcset.o
 
 # For Linux
 linux:
-	$(MAKE) lpeg.so "DLLFLAGS = -shared -fPIC"
+	$(MAKE) lpeg.dylib "DLLFLAGS = -shared -fPIC"
 
 # For Mac OS
 macosx:
-	$(MAKE) lpeg.so "DLLFLAGS = -bundle -undefined dynamic_lookup"
+	$(MAKE) lpeg.dylib "DLLFLAGS = -dynamiclib -undefined dynamic_lookup"
 
-lpeg.so: $(FILES)
-	env $(CC) $(DLLFLAGS) $(FILES) -o lpeg.so
+lpeg.dylib: $(FILES)
+	env $(CC) $(DLLFLAGS) $(FILES) -o lpeg.dylib
 
 $(FILES): makefile
 
-test: test.lua re.lua lpeg.so
+test: test.lua re.lua lpeg.dylib
 	./test.lua
 
 clean:
-	rm -f $(FILES) lpeg.so
+	rm -f $(FILES) lpeg.dylib
 
 
 lpcap.o: lpcap.c lpcap.h lptypes.h
